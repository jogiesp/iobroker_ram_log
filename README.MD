# üêç ioBroker-Logs im RAM ‚Äì Das Projekt, das deine SD-Karte liebt

## üìë Inhaltsverzeichnis
- [Was dieses Projekt tut](#was-dieses-projekt-tut)
- [Wichtiger Punkt Cron beim Boot](#wichtiger-punkt-cron-beim-boot)
- [Anleitung Schritt f√ºr Schritt](#anleitung-schritt-fuer-schritt)
  - [1 Vorbereitendes Skript erstellen](#1-vorbereitendes-skript-erstellen)
  - [2 Cron-Job f√ºr Boot einrichten](#2-cron-job-fuer-boot-einrichten)
  - [3 Cron-Job Alte Logs l√∂schen optional](#3-cron-job-alte-logs-loeschen-optional)
  - [4 Test](#4-test)
- [Bonus Tipps](#bonus-tipps)
- [Vorteile](#vorteile)
- [Nachteile Risiken](#nachteile-risiken)
- [RAM-Log R√ºckbau Mini-Checkliste](#ram-log-rueckbau-mini-checkliste)
- [Haftungsausschluss](#haftungsausschluss)

---

<a id="was-dieses-projekt-tut"></a>
## üéØ Was dieses Projekt tut

1. Es wird ein **RAM-Verzeichnis** erstellt (`/run/iobroker-logs`), das beim Neustart leer ist üí®.
2. Die bisherigen Log-Dateien werden dorthin verschoben, und ein **symbolischer Link** sorgt daf√ºr, dass ioBroker denkt, alles sei wie gewohnt (`/opt/iobroker/log`) üîó.
3. Ein **Cron-Job mit `@reboot`** erstellt das RAM-Verzeichnis und startet ioBroker beim Boot.
4. Alte Logs im RAM werden automatisch gel√∂scht ‚Äì alles l√§uft **von alleine**.

---

<a id="wichtiger-punkt-cron-beim-boot"></a>
## ‚ö†Ô∏è Wichtiger Punkt Cron beim Boot

> Dies ist **der entscheidende Punkt**, damit ioBroker nach jedem Neustart funktioniert.
> Wenn Cron nicht korrekt eingerichtet ist, startet ioBroker **nicht** und Logs existieren nicht.

---

<a id="anleitung-schritt-fuer-schritt"></a>
## üßë‚Äçüíª Anleitung Schritt f√ºr Schritt

<a id="1-vorbereitendes-skript-erstellen"></a>
### 1Ô∏è‚É£ Vorbereitendes Skript erstellen

```bash
sudo nano /usr/local/bin/iobroker-ramlog.sh
````

Inhalt:

```bash
#!/bin/bash
# RAM-Log f√ºr ioBroker vorbereiten

# 1. RAM-Verzeichnis anlegen
mkdir -p /run/iobroker-logs/iobroker
chown -R iobroker:iobroker /run/iobroker-logs

# 2. Symbolischen Link setzen
ln -sfn /run/iobroker-logs/iobroker /opt/iobroker/log

# 3. ioBroker starten
systemctl start iobroker.service
```

Speichern und ausf√ºhrbar machen:

```bash
sudo chmod +x /usr/local/bin/iobroker-ramlog.sh
```

---

<a id="2-cron-job-fuer-boot-einrichten"></a>

### 2Ô∏è‚É£ Cron-Job f√ºr Boot einrichten

* Cron f√ºr root bearbeiten:

```bash
sudo crontab -e
```

* Folgende Zeile hinzuf√ºgen:

```cron
@reboot /usr/local/bin/iobroker-ramlog.sh
```

üí° **Erkl√§rung:**

* `@reboot` ‚Üí Skript wird **bei jedem Boot automatisch ausgef√ºhrt**
* Erst wird das RAM-Verzeichnis erstellt, dann der Link gesetzt, und iobroker gestartet

> **WICHTIG:** Ohne diesen Schritt startet ioBroker nach einem Neustart **nicht** und das RAM-Log existiert nicht. Dies ist der zentrale Punkt f√ºr eine funktionierende Einrichtung!

---

<a id="3-cron-job-alte-logs-loeschen-optional"></a>

### 3Ô∏è‚É£ Cron-Job Alte Logs l√∂schen optional

Damit der RAM nicht voll wird, kannst du einen weiteren Cron-Job einrichten, z.‚ÄØB. alle 2 Tage:

```bash
sudo crontab -e
```

F√ºge hinzu:

```cron
0 4 */2 * * rm -rf /run/iobroker-logs/iobroker/*
```

* `0 4 */2 * *` ‚Üí alle 2 Tage um 04:00 Uhr morgens
* `rm -rf /run/iobroker-logs/iobroker/*` ‚Üí l√∂scht alle Dateien im Log-Verzeichnis
* ioBroker legt beim n√§chsten Log-Eintrag automatisch neue Dateien an

---

<a id="4-test"></a>

### 4Ô∏è‚É£ Test

* Neustart durchf√ºhren:

```bash
sudo reboot
```

* Pr√ºfen:

```bash
ls -l /run/iobroker-logs/iobroker
tail -f /opt/iobroker/log/iobroker.current.log
systemctl status iobroker.service
```

‚úÖ Ergebnis:

* RAM-Verzeichnis existiert sofort nach Boot
* Symbolischer Link ist korrekt
* ioBroker startet automatisch
* Alte Logs k√∂nnen per Cron gel√∂scht werden

---

<a id="bonus-tipps"></a>

## üí° Bonus Tipps

* Backup-Skripte einbauen, falls bestimmte Logs doch auf SD gespeichert werden sollen üíæ
* Logs live beobachten:

```bash
tail -f /opt/iobroker/log/iobroker.current.log
```

* Die SD-Karte wird entspannt geschont üê∂üõãÔ∏è, w√§hrend der RAM alles erledigt ‚ö°

---

<a id="vorteile"></a>

## ‚úÖ Vorteile

* SD-Karte wird **geschont** ‚Äì weniger Verschlei√ü
* ioBroker-Logs werden **schnell im RAM geschrieben**
* Automatisches L√∂schen alter Logs verhindert RAM-Stau
* Einfache Einrichtung √ºber Cron, **kein komplexes Systemd-Ged√∂ns**
* F√ºr Anf√§nger leicht verst√§ndlich

---

<a id="nachteile-risiken"></a>

## ‚ö†Ô∏è Nachteile Risiken

* Logs gehen beim Neustart **verloren**, au√üer ein Backup wird erstellt
* RAM wird f√ºr Logs verwendet ‚Üí bei sehr gro√üen Log-Mengen kann RAM knapp werden
* **Cron muss korrekt eingerichtet sein** ‚Äì sonst startet ioBroker nicht und Logs existieren nicht
* Wenn der Pi abst√ºrzt, gehen alle Logs im RAM verloren

---

<a id="ram-log-rueckbau-mini-checkliste"></a>

## üîß RAM-Log R√ºckbau Mini-Checkliste

1. **ioBroker stoppen**

```bash
sudo systemctl stop iobroker.service
```

2. **RAM-Logs sichern**

```bash
sudo mkdir -p /opt/iobroker/log_backup
sudo cp -r /run/iobroker-logs/iobroker/* /opt/iobroker/log_backup/
sudo chown -R iobroker:iobroker /opt/iobroker/log_backup
```

3. **Link entfernen & Original-Verzeichnis wiederherstellen**

```bash
sudo rm /opt/iobroker/log
sudo mkdir -p /opt/iobroker/log
sudo chown -R iobroker:iobroker /opt/iobroker/log
```

4. **Cron und Systemd-Service l√∂schen**

```bash
sudo crontab -e    # RAM-Log Zeilen l√∂schen
sudo systemctl disable iobroker-ramlog.service
sudo rm /etc/systemd/system/iobroker-ramlog.service
sudo systemctl daemon-reload
```

5. **ioBroker neu starten & Kontrolle**

```bash
sudo systemctl start iobroker.service
ls -l /opt/iobroker/log
ls -l /opt/iobroker/log_backup
```

* `/opt/iobroker/log` ‚Üí normales Log-Verzeichnis auf SD
* `/opt/iobroker/log_backup` ‚Üí gesicherte RAM-Logs

---

<a id="haftungsausschluss"></a>

## üìù Haftungsausschluss

Dieses Projekt wird **ohne Garantie** bereitgestellt.
Der Autor √ºbernimmt **keine Haftung** f√ºr Sch√§den an Hardware, Datenverlust oder sonstige Probleme.
Benutzung erfolgt **auf eigene Verantwortung**.

```